<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mortgage Customer Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Default Theme Variables */
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #60a5fa;
            --secondary: #f8fafc;
            --dark: #0f172a;
            --light: #f1f5f9;
            --success: #0ea5e9;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #06b6d4;
            --gray: #64748b;
            --gray-light: #f1f5f9;
            --header-bg: var(--dark);
            --header-text: white;
            --body-bg: var(--light);
            --body-text: #334155;
            --card-bg: white;
            --card-border: none;
            --theme-shadow: rgba(0, 0, 0, 0.08);
            --bg-pattern: none;
            --animate-speed: 0.3s;
        }

        /* Space Theme */
        .theme-space {
            --primary: #7e57c2;
            --primary-dark: #5e35b1;
            --primary-light: #9575cd;
            --secondary: #b388ff;
            --dark: #1a237e;
            --light: #e8eaf6;
            --success: #64dd17;
            --danger: #f44336;
            --warning: #ffab00;
            --info: #00b0ff;
            --gray: #546e7a;
            --gray-light: #eceff1;
            --header-bg: linear-gradient(135deg, #1a237e 0%, #283593 50%, #3949ab 100%);
            --header-text: #e8eaf6;
            --body-bg: #0f172a;
            --body-text: #e8eaf6;
            --card-bg: rgba(21, 31, 46, 0.85);
            --card-border: 1px solid #3d5afe;
            --theme-shadow: rgba(63, 81, 181, 0.3);
            --bg-pattern: radial-gradient(circle, rgba(25, 32, 72, 0.7) 0%, rgba(15, 23, 42, 0.9) 100%);
            --animate-speed: 0.5s;
        }
        
        /* Hippy Hiker Theme */
        .theme-hippy-hiker {
            --primary: #2e7d32;
            --primary-dark: #1b5e20;
            --primary-light: #4caf50;
            --secondary: #81c784;
            --dark: #1b5e20;
            --light: #e8f5e9;
            --success: #00796b;
            --danger: #e53935;
            --warning: #ff8f00;
            --info: #0288d1;
            --gray: #5d4037;
            --gray-light: #efebe9;
            --header-bg: linear-gradient(135deg, #1b5e20 0%, #2e7d32 50%, #388e3c 100%);
            --header-text: #f1f8e9;
            --body-bg: #e8f5e9;
            --body-text: #33691e;
            --card-bg: rgba(255, 255, 255, 0.85);
            --card-border: 1px solid rgba(76, 175, 80, 0.3);
            --theme-shadow: rgba(46, 125, 50, 0.2);
            --bg-pattern: linear-gradient(rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7));
            --animate-speed: 0.4s;
        }
        
        /* Hawaii Beach Theme */
        .theme-hawaii {
            --primary: #00b0ff;
            --primary-dark: #0091ea;
            --primary-light: #40c4ff;
            --secondary: #ffcc80;
            --dark: #01579b;
            --light: #e1f5fe;
            --success: #00bfa5;
            --danger: #ff5252;
            --warning: #ffd740;
            --info: #29b6f6;
            --gray: #78909c;
            --gray-light: #e0f7fa;
            --header-bg: linear-gradient(135deg, #0277bd 0%, #039be5 50%, #29b6f6 100%);
            --header-text: #e1f5fe;
            --body-bg: #e0f7fa;
            --body-text: #01579b;
            --card-bg: rgba(255, 255, 255, 0.8);
            --card-border: 1px solid rgba(3, 169, 244, 0.2);
            --theme-shadow: rgba(3, 169, 244, 0.15);
            --bg-pattern: linear-gradient(rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6));
            --animate-speed: 0.4s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: all 0.2s ease;
        }

        body {
            background-color: var(--body-bg);
            background-image: var(--bg-pattern);
            color: var(--body-text);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Main Container */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header Styles */
        header {
            background: var(--header-bg);
            color: var(--header-text);
            padding: 1.25rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            font-size: 1.75rem;
            animation: pulse 2s infinite ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-text h1 {
            font-size: 1.5rem;
            font-weight: 600;
            line-height: 1.2;
            margin: 0;
        }

        .logo-text p {
            font-size: 0.9rem;
            opacity: 0.8;
            margin: 0;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .theme-toggle {
            background-color: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--header-text);
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .theme-toggle i {
            font-size: 1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* Dashboard Stats */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 1024px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 10px var(--theme-shadow);
            border: var(--card-border);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform var(--animate-speed);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .icon {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
            height: 2.5rem;
            width: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .stat-primary .icon {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--primary);
        }

        .stat-info .icon {
            background-color: rgba(6, 182, 212, 0.1);
            color: var(--info);
        }

        .stat-warning .icon {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .stat-success .icon {
            background-color: rgba(14, 165, 233, 0.1);
            color: var(--success);
        }

        .stat-card h3 {
            font-size: 1.75rem;
            font-weight: 700;
            margin: 0.5rem 0;
            color: var(--dark);
        }

        .theme-space .stat-card h3 {
            color: white;
        }

        .stat-card p {
            font-size: 0.875rem;
            color: var(--gray);
            margin: 0;
        }

        .theme-space .stat-card p {
            color: #a8b2d1;
        }

        /* Action Bar */
        .action-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .filters {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .filter-select {
            background-color: var(--card-bg);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            color: var(--body-text);
            min-width: 150px;
        }

        .theme-space .filter-select {
            background-color: rgba(41, 59, 115, 0.6);
            border-color: #3d5afe;
            color: white;
        }

        .theme-space .filter-select option {
            background-color: #151f2e;
        }

        .search-actions {
            display: flex;
            gap: 0.75rem;
        }

        /* Buttons */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.3s;
            border: none;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background-color: var(--gray);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #475569;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .theme-space .btn {
            box-shadow: 0 2px 10px rgba(122, 87, 209, 0.2);
        }

        .theme-space .btn-primary {
            background-color: var(--primary);
        }

        .theme-space .btn-primary:hover {
            background-color: var(--primary-dark);
            box-shadow: 0 4px 15px rgba(122, 87, 209, 0.4);
        }

        /* Dashboard Layout */
        .dashboard {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background-color: var(--card-bg);
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px var(--theme-shadow);
            border: var(--card-border);
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .theme-space .card-header {
            border-bottom: 1px solid rgba(61, 90, 254, 0.2);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
            color: var(--dark);
        }

        .theme-space .card-title {
            color: white;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            overflow-x: auto;
            white-space: nowrap;
        }

        .theme-space .tabs {
            border-bottom: 1px solid rgba(61, 90, 254, 0.2);
        }

        .tab {
            padding: 0.75rem 1.25rem;
            cursor: pointer;
            position: relative;
            font-weight: 500;
            color: var(--gray);
        }

        .tab.active {
            color: var(--primary);
        }

        .tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .tab.active::after {
            transform: scaleX(1);
        }

        .tab-content {
            display: none;
            padding: 1.25rem;
        }

        .tab-content.active {
            display: block;
        }

        /* Search */
        .search-bar {
            position: relative;
            margin-bottom: 1rem;
        }

        .search-bar input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border-radius: 0.375rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background-color: var(--card-bg);
            color: var(--body-text);
        }

        .theme-space .search-bar input {
            background-color: rgba(41, 59, 115, 0.6);
            border-color: #3d5afe;
            color: white;
        }

        .search-bar i {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .theme-space .search-bar i {
            color: #a8b2d1;
        }

        /* Customer List */
        .customer-list {
            max-height: 650px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .customer-card {
            background-color: var(--card-bg);
            border-radius: 0.75rem;
            box-shadow: 0 2px 8px var(--theme-shadow);
            padding: 1.25rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary);
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .theme-space .customer-card {
            background-color: rgba(30, 41, 59, 0.7);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border-left: 4px solid var(--primary);
        }

        .customer-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px var(--theme-shadow);
        }

        .customer-card h3 {
            font-size: 1.125rem;
            margin-bottom: 0.75rem;
            color: var(--dark);
            padding-right: 80px;
        }

        .theme-space .customer-card h3 {
            color: white;
        }

        .customer-card-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        @media (max-width: 480px) {
            .customer-card-details {
                grid-template-columns: 1fr;
            }
        }

        .customer-card-details p {
            margin: 0;
            color: var(--gray);
        }

        .theme-space .customer-card-details p {
            color: #a8b2d1;
        }

        .customer-card-details strong {
            color: var(--body-text);
            display: inline-block;
            min-width: 90px;
        }

        .theme-space .customer-card-details strong {
            color: #e2e8f0;
        }

        .customer-actions {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.375rem;
        }

        .action-btn {
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.25rem;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .edit-btn {
            color: var(--info);
        }

        .edit-btn:hover {
            background-color: var(--info);
            color: white;
        }

        .delete-btn {
            color: var(--danger);
        }

        .delete-btn:hover {
            background-color: var(--danger);
            color: white;
        }

        .call-btn {
            color: var(--success);
        }

        .call-btn:hover {
            background-color: var(--success);
            color: white;
        }

        .badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.25rem;
        }

        .badge-warning {
            background-color: var(--warning);
            color: #171717;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.25rem;
        }

        label {
            display: block;
            margin-bottom: 0.375rem;
            font-weight: 500;
            color: var(--body-text);
        }

        .theme-space label {
            color: #e2e8f0;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.375rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background-color: var(--card-bg);
            color: var(--body-text);
            font-size: 0.9375rem;
        }

        .theme-space input, 
        .theme-space select, 
        .theme-space textarea {
            background-color: rgba(41, 59, 115, 0.6);
            border-color: #3d5afe;
            color: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }

        .form-row {
            display: flex;
            gap: 1.25rem;
            margin-bottom: 1.25rem;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        @media (max-width: 640px) {
            .form-row {
                flex-direction: column;
                gap: 1.25rem;
            }
        }

        /* Customer Detail Cards */
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 768px) {
            .detail-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .detail-grid {
                grid-template-columns: 1fr;
            }
        }

        .detail-item {
            background-color: rgba(0, 0, 0, 0.03);
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .theme-space .detail-item {
            background-color: rgba(41, 59, 115, 0.3);
        }

        .detail-item h4 {
            font-size: 0.8125rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--gray);
        }

        .theme-space .detail-item h4 {
            color: #a8b2d1;
        }

        .detail-item p {
            font-size: 1.0625rem;
            font-weight: 600;
            margin: 0;
            color: var(--dark);
        }

        .theme-space .detail-item p {
            color: white;
        }

        /* Contact Log */
        .contact-entry {
            background-color: rgba(0, 0, 0, 0.03);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .theme-space .contact-entry {
            background-color: rgba(41, 59, 115, 0.3);
        }

        .contact-entry-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            align-items: center;
        }

        .contact-date {
            font-size: 0.8125rem;
            color: var(--gray);
        }

        .theme-space .contact-date {
            color: #a8b2d1;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1.5rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .theme-space .empty-state h3 {
            color: white;
        }

        .empty-state p {
            margin-bottom: 1.5rem;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s;
        }

        .modal.active {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 0.75rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .theme-space .modal-content {
            border: 1px solid rgba(61, 90, 254, 0.3);
        }

        .modal-header {
            padding: 1.25rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .theme-space .modal-header {
            border-bottom: 1px solid rgba(61, 90, 254, 0.2);
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.25rem;
            color: var(--dark);
        }

        .theme-space .modal-header h2 {
            color: white;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            color: var(--gray);
        }

        .theme-space .close-modal {
            color: #a8b2d1;
        }

        .modal-body {
            padding: 1.25rem;
        }

        .modal-footer {
            padding: 1.25rem;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        .theme-space .modal-footer {
            border-top: 1px solid rgba(61, 90, 254, 0.2);
        }

        /* Toast Notifications */
        #toastContainer {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 9999;
        }

        .toast {
            padding: 0.75rem 1.25rem;
            margin-bottom: 0.75rem;
            border-radius: 0.375rem;
            background-color: white;
            color: var(--dark);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transform: translateX(120%);
            transition: all 0.3s ease;
            max-width: 350px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-icon {
            font-size: 1.25rem;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 0.125rem;
        }

        .toast-message {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        .toast-success {
            border-left: 4px solid var(--success);
        }

        .toast-success .toast-icon {
            color: var(--success);
        }

        .toast-error {
            border-left: 4px solid var(--danger);
        }

        .toast-error .toast-icon {
            color: var(--danger);
        }

        .toast-info {
            border-left: 4px solid var(--info);
        }

        .toast-info .toast-icon {
            color: var(--info);
        }

        .toast-warning {
            border-left: 4px solid var(--warning);
        }

        .toast-warning .toast-icon {
            color: var(--warning);
        }

        /* Space Theme Special Effects */
        .theme-space .stat-card {
            position: relative;
            overflow: hidden;
        }

        .theme-space .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(124, 58, 237, 0.1) 0%, rgba(21, 31, 46, 0) 70%);
            z-index: -1;
            animation: rotate 15s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .theme-space .card {
            position: relative;
            backdrop-filter: blur(10px);
        }

        .theme-space .card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(138, 126, 242, 0.8), transparent);
        }
        
        /* Hippy Hiker Theme Special Effects */
        .theme-hippy-hiker .stat-card {
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border-radius: 1rem;
            border-left: 4px solid var(--primary);
        }
        
        .theme-hippy-hiker .card {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border-radius: 1rem;
            border: none;
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
        }
        
        .theme-hippy-hiker .card-header {
            background-color: rgba(46, 125, 50, 0.1);
            border-bottom: 2px solid rgba(46, 125, 50, 0.2);
        }
        
        .theme-hippy-hiker .tabs {
            background-color: rgba(255, 255, 255, 0.5);
        }
        
        .theme-hippy-hiker .btn-primary {
            background: linear-gradient(135deg, #2e7d32, #43a047);
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
            border-radius: 2rem;
        }
        
        .theme-hippy-hiker .btn-secondary {
            background: linear-gradient(135deg, #5d4037, #795548);
            box-shadow: 0 4px 10px rgba(93, 64, 55, 0.3);
            border-radius: 2rem;
        }
        
        .theme-hippy-hiker .btn-primary:hover,
        .theme-hippy-hiker .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }
        
        .theme-hippy-hiker .customer-card {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 1rem;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }
        
        .theme-hippy-hiker .customer-card:hover {
            transform: translateY(-5px) rotate(1deg);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        /* Hawaii Beach Theme Special Effects */
        .theme-hawaii .stat-card {
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(3, 169, 244, 0.15);
            border-radius: 1rem;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(225, 245, 254, 0.85));
            border: none;
            backdrop-filter: blur(5px);
        }
        
        .theme-hawaii .card {
            box-shadow: 0 10px 20px rgba(3, 169, 244, 0.1);
            border-radius: 1rem;
            border: none;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .theme-hawaii .card-header {
            background: linear-gradient(90deg, rgba(3, 169, 244, 0.1), rgba(0, 145, 234, 0.2));
            border-bottom: 2px solid rgba(3, 169, 244, 0.2);
        }
        
        .theme-hawaii .tabs {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .theme-hawaii .btn-primary {
            background: linear-gradient(135deg, #0288d1, #29b6f6);
            box-shadow: 0 4px 10px rgba(3, 169, 244, 0.3);
            border-radius: 2rem;
        }
        
        .theme-hawaii .btn-secondary {
            background: linear-gradient(135deg, #00838f, #00acc1);
            box-shadow: 0 4px 10px rgba(0, 131, 143, 0.3);
            border-radius: 2rem;
        }
        
        .theme-hawaii .btn-primary:hover,
        .theme-hawaii .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }
        
        .theme-hawaii .customer-card {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 1rem;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }
        
        .theme-hawaii .customer-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(3, 169, 244, 0.2);
        }
        
        .theme-hawaii .detail-item {
            background-color: rgba(225, 245, 254, 0.4);
            border-radius: 0.75rem;
        }

        /* Scrollbar Styles */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        .theme-space ::-webkit-scrollbar-track {
            background: rgba(61, 90, 254, 0.1);
        }

        .theme-space ::-webkit-scrollbar-thumb {
            background: rgba(61, 90, 254, 0.4);
        }

        .theme-space ::-webkit-scrollbar-thumb:hover {
            background: rgba(61, 90, 254, 0.7);
        }

        /* Stars Animation for Space Theme */
        .stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .theme-space .stars-container {
            opacity: 1;
        }

        .star {
            position: absolute;
            background-color: #fff;
            border-radius: 50%;
            opacity: 0.7;
            animation: twinkle var(--twinkle-duration) ease-in-out infinite;
            animation-delay: var(--twinkle-delay);
        }
        
        /* Hippy Hiker Nature Elements */
        .nature-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.8s ease;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="1000" viewBox="0 0 1000 1000"><defs><linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="%2387CEEB"/><stop offset="100%" stop-color="%23E0F7FA"/></linearGradient><linearGradient id="mountainGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="%23795548"/><stop offset="100%" stop-color="%235D4037"/></linearGradient><linearGradient id="forestGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="%232E7D32"/><stop offset="100%" stop-color="%231B5E20"/></linearGradient><linearGradient id="waterfallGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="%2329B6F6"/><stop offset="100%" stop-color="%230288D1"/></linearGradient></defs><rect width="1000" height="1000" fill="url(%23skyGradient)"/><path d="M0,400 Q250,200 500,350 T1000,300 L1000,1000 L0,1000 Z" fill="url(%23mountainGradient)"/><path d="M0,450 Q200,350 400,450 T800,400 T1000,450 L1000,1000 L0,1000 Z" fill="url(%23forestGradient)"/><path d="M600,400 C580,450 620,500 600,550 C580,600 620,650 600,700 C580,750 620,800 600,850 L580,850 C600,800 560,750 580,700 C600,650 560,600 580,550 C600,500 560,450 580,400 Z" fill="url(%23waterfallGradient)" opacity="0.7"/><circle cx="850" cy="150" r="60" fill="%23FDB813"/></svg>');
            background-size: cover;
            background-position: center;
        }
        
        .theme-hippy-hiker .nature-container {
            opacity: 1;
        }
        
        /* Floating leaves animation */
        .leaf {
            position: absolute;
            width: 15px;
            height: 15px;
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.8;
            animation: float 10s linear infinite;
        }
        
        .leaf1 {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50,0 C70,25 90,40 100,50 C90,60 70,75 50,100 C30,75 10,60 0,50 C10,40 30,25 50,0 Z" fill="%234CAF50"/></svg>');
        }
        
        .leaf2 {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M20,0 C60,30 100,60 100,85 C100,95 90,100 75,100 C55,100 0,55 0,30 C0,10 10,0 20,0 Z" fill="%2343A047"/></svg>');
        }
        
        /* Hawaii Beach Elements */
        .beach-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.8s ease;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="1000" viewBox="0 0 1000 1000"><defs><linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="%2387CEFA"/><stop offset="100%" stop-color="%23E1F5FE"/></linearGradient><linearGradient id="oceanGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="%2300B8D4"/><stop offset="100%" stop-color="%230277BD"/></linearGradient><linearGradient id="sandGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="%23FFECB3"/><stop offset="100%" stop-color="%23FFE082"/></linearGradient><linearGradient id="palmGradient" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="%23689F38"/><stop offset="100%" stop-color="%23558B2F"/></linearGradient></defs><rect width="1000" height="1000" fill="url(%23skyGradient)"/><path d="M0,400 L1000,450 L1000,1000 L0,1000 Z" fill="url(%23oceanGradient)"/><path d="M0,500 C200,480 350,500 650,470 C800,450 900,480 1000,470 L1000,1000 L0,1000 Z" fill="url(%23sandGradient)"/><path d="M800,470 L810,420 L815,410 L820,400 L830,380 L830,370 L820,365 L810,370 L815,380 L810,390 L805,400 L802,410 L800,420 L795,440 L800,470 Z" fill="%235D4037"/><path d="M750,300 C780,270 830,300 850,330 C870,360 830,380 800,360 C770,340 720,330 750,300 Z" fill="url(%23palmGradient)"/><path d="M850,330 C880,310 930,350 940,390 C950,430 900,430 880,400 C860,370 820,350 850,330 Z" fill="url(%23palmGradient)"/><path d="M850,330 C820,300 840,240 880,220 C920,200 940,260 910,290 C880,320 880,360 850,330 Z" fill="url(%23palmGradient)"/><circle cx="200" cy="150" r="60" fill="%23FFC107"/></svg>');
            background-size: cover;
            background-position: center;
        }
        
        .theme-hawaii .beach-container {
            opacity: 1;
        }
        
        /* Beach wave animation */
        @keyframes wave {
            0% { transform: translateX(-100%) translateZ(0); }
            100% { transform: translateX(100%) translateZ(0); }
        }
        
        .wave {
            position: absolute;
            bottom: 25%;
            left: 0;
            width: 200%;
            height: 150px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none"><path d="M0,0 C150,20 300,40 450,40 C600,40 750,20 900,20 C1050,20 1200,40 1200,40 L1200,120 L0,120 Z" fill="%2329B6F6" opacity="0.3"/></svg>');
            background-size: 1200px 100%;
            animation: wave 25s infinite linear;
        }
        
        .wave-back {
            opacity: 0.3;
            animation: wave 20s infinite linear;
            bottom: 25%;
            height: 140px;
        }
        
        /* Palm tree bobbing */
        @keyframes bobbing {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(2deg); }
        }
        
        @keyframes float {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(1000px) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="stars-container" id="starsContainer"></div>
    <div class="nature-container" id="natureContainer"></div>
    <div class="beach-container" id="beachContainer">
        <div class="wave wave-back"></div>
        <div class="wave"></div>
    </div>
    
    <div class="app-container">
        <header>
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-home"></i>
                </div>
                <div class="logo-text">
                    <h1>Mortgage Customer Manager</h1>
                    <p>Track and manage your funded loans</p>
                </div>
            </div>
            <div class="header-actions">
                <button id="themeToggleBtn" class="theme-toggle">
                    <i class="fas fa-moon"></i>
                    <span id="currentTheme">Default</span>
                </button>
                <button id="importExportBtn" class="btn btn-secondary">
                    <i class="fas fa-file-export"></i>
                    Import/Export
                </button>
                <button id="addCustomerBtn" class="btn btn-primary">
                    <i class="fas fa-user-plus"></i>
                    Add Customer
                </button>
            </div>
        </header>

        <div class="main-content">
            <div class="stats-container">
                <div class="stat-card stat-primary">
                    <div class="icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3 id="totalCustomers">0</h3>
                    <p>Total Customers</p>
                </div>
                <div class="stat-card stat-info">
                    <div class="icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <h3 id="totalLoans">$0</h3>
                    <p>Total Loan Volume</p>
                </div>
                <div class="stat-card stat-warning">
                    <div class="icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h3 id="duplicateContacts">0</h3>
                    <p>Duplicate Contacts</p>
                </div>
                <div class="stat-card stat-success">
                    <div class="icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3 id="avgLoanAmount">$0</h3>
                    <p>Avg. Loan Amount</p>
                </div>
            </div>

            <div class="action-bar">
                <div class="filters">
                    <select id="filterLoanPurpose" class="filter-select">
                        <option value="">All Loan Purposes</option>
                        <option value="Purchase">Purchase</option>
                        <option value="Refinance">Refinance</option>
                        <option value="Cash-Out Refinance">Cash-Out Refinance</option>
                        <option value="Home Equity">Home Equity</option>
                    </select>
                    <select id="filterState" class="filter-select">
                        <option value="">All States</option>
                    </select>
                </div>
            </div>

            <div class="dashboard">
                <div class="left-panel">
                    <div class="card">
                        <div class="card-body">
                            <div class="search-bar">
                                <i class="fas fa-search"></i>
                                <input type="text" id="searchInput" placeholder="Search customers...">
                            </div>
                            <div class="tabs">
                                <div class="tab active" data-tab="allCustomers">All Customers</div>
                                <div class="tab" data-tab="duplicateContacts">Duplicate Contacts</div>
                            </div>
                            <div id="customerList" class="customer-list">
                                <div class="empty-state">
                                    <i class="fas fa-users"></i>
                                    <h3>No customers yet</h3>
                                    <p>Add your first customer to get started</p>
                                    <button id="welcomeAddBtn" class="btn btn-primary">Add Your First Customer</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="right-panel">
                    <div id="customerForm" class="card" style="display: none;">
                        <div class="card-header">
                            <h2 class="card-title">Add New Customer</h2>
                        </div>
                        <div class="card-body">
                            <form id="addEditCustomerForm">
                                <input type="hidden" id="customerId">
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="primaryFirstName">Primary Borrower First Name</label>
                                        <input type="text" id="primaryFirstName" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="primaryLastName">Primary Borrower Last Name</label>
                                        <input type="text" id="primaryLastName" required>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="coFirstName">Co-Borrower First Name</label>
                                        <input type="text" id="coFirstName">
                                    </div>
                                    <div class="form-group">
                                        <label for="coLastName">Co-Borrower Last Name</label>
                                        <input type="text" id="coLastName">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="primaryPhone">Primary Phone</label>
                                        <input type="tel" id="primaryPhone" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="primaryCellPhone">Cell Phone</label>
                                        <input type="tel" id="primaryCellPhone">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="whenToCall">Best Time to Call</label>
                                        <input type="text" id="whenToCall">
                                    </div>
                                    <div class="form-group">
                                        <label for="email">Email</label>
                                        <input type="email" id="email">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="propertyValue">Property Value</label>
                                        <input type="number" id="propertyValue" required min="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="loanAmount">Loan Amount</label>
                                        <input type="number" id="loanAmount" required min="0">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="ltv">LTV</label>
                                        <input type="text" id="ltv" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="refinanceTargetRate">Refinance Target Rate</label>
                                        <input type="text" id="refinanceTargetRate" placeholder="e.g. 4.25%">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="rate">Current Rate</label>
                                        <input type="text" id="rate">
                                    </div>
                                    <div class="form-group">
                                        <label for="loanPurpose">Loan Purpose</label>
                                        <select id="loanPurpose" required>
                                            <option value="">Select Purpose</option>
                                            <option value="Purchase">Purchase</option>
                                            <option value="Refinance">Refinance</option>
                                            <option value="Cash-Out Refinance">Cash-Out Refinance</option>
                                            <option value="Home Equity">Home Equity</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="propertyAddress">Property Address</label>
                                        <input type="text" id="propertyAddress" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="propertyState">State</label>
                                        <select id="propertyState" required>
                                            <option value="">Select State</option>
                                            <option value="AL">Alabama</option>
                                            <option value="AK">Alaska</option>
                                            <option value="AZ">Arizona</option>
                                            <option value="AR">Arkansas</option>
                                            <option value="CA">California</option>
                                            <option value="CO">Colorado</option>
                                            <option value="CT">Connecticut</option>
                                            <option value="DE">Delaware</option>
                                            <option value="FL">Florida</option>
                                            <option value="GA">Georgia</option>
                                            <option value="HI">Hawaii</option>
                                            <option value="ID">Idaho</option>
                                            <option value="IL">Illinois</option>
                                            <option value="IN">Indiana</option>
                                            <option value="IA">Iowa</option>
                                            <option value="KS">Kansas</option>
                                            <option value="KY">Kentucky</option>
                                            <option value="LA">Louisiana</option>
                                            <option value="ME">Maine</option>
                                            <option value="MD">Maryland</option>
                                            <option value="MA">Massachusetts</option>
                                            <option value="MI">Michigan</option>
                                            <option value="MN">Minnesota</option>
                                            <option value="MS">Mississippi</option>
                                            <option value="MO">Missouri</option>
                                            <option value="MT">Montana</option>
                                            <option value="NE">Nebraska</option>
                                            <option value="NV">Nevada</option>
                                            <option value="NH">New Hampshire</option>
                                            <option value="NJ">New Jersey</option>
                                            <option value="NM">New Mexico</option>
                                            <option value="NY">New York</option>
                                            <option value="NC">North Carolina</option>
                                            <option value="ND">North Dakota</option>
                                            <option value="OH">Ohio</option>
                                            <option value="OK">Oklahoma</option>
                                            <option value="OR">Oregon</option>
                                            <option value="PA">Pennsylvania</option>
                                            <option value="RI">Rhode Island</option>
                                            <option value="SC">South Carolina</option>
                                            <option value="SD">South Dakota</option>
                                            <option value="TN">Tennessee</option>
                                            <option value="TX">Texas</option>
                                            <option value="UT">Utah</option>
                                            <option value="VT">Vermont</option>
                                            <option value="VA">Virginia</option>
                                            <option value="WA">Washington</option>
                                            <option value="WV">West Virginia</option>
                                            <option value="WI">Wisconsin</option>
                                            <option value="WY">Wyoming</option>
                                            <option value="DC">District of Columbia</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="lender">Lender</label>
                                        <input type="text" id="lender">
                                    </div>
                                    <div class="form-group">
                                        <label for="fundedDate">Funded Date</label>
                                        <input type="date" id="fundedDate">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="notes">Notes</label>
                                    <textarea id="notes" rows="3"></textarea>
                                </div>
                                
                                <div class="form-row">
                                    <button type="submit" class="btn btn-primary">Save Customer</button>
                                    <button type="button" id="cancelFormBtn" class="btn btn-secondary">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="customerDetail" class="card" style="display: none;">
                        <div class="card-header">
                            <h2 class="card-title" id="customerName">Customer Details</h2>
                        </div>
                        <div class="card-body">
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <h4>Loan Amount</h4>
                                    <p id="detailLoanAmount">$0</p>
                                </div>
                                <div class="detail-item">
                                    <h4>Loan Purpose</h4>
                                    <p id="detailLoanPurpose">-</p>
                                </div>
                                <div class="detail-item">
                                    <h4>Interest Rate</h4>
                                    <p id="detailRate">-</p>
                                </div>
                                <div class="detail-item">
                                    <h4>Property</h4>
                                    <p id="detailProperty">-</p>
                                </div>
                                <div class="detail-item">
                                    <h4>Phone</h4>
                                    <p id="detailPhone">-</p>
                                </div>
                                <div class="detail-item">
                                    <h4>Best Time to Call</h4>
                                    <p id="detailWhenToCall">-</p>
                                </div>
                            </div>
                            
                            <div class="tabs">
                                <div class="tab active" data-tab="customerInfo">Customer Info</div>
                                <div class="tab" data-tab="contactLog">Contact Log</div>
                            </div>
                            
                            <div id="customerInfo" class="tab-content active">
                                <div class="customer-card-details">
                                    <p><strong>Primary Borrower:</strong> <span id="detailPrimaryBorrower">-</span></p>
                                    <p><strong>Co-Borrower:</strong> <span id="detailCoBorrower">-</span></p>
                                    <p><strong>Cell Phone:</strong> <span id="detailCellPhone">-</span></p>
                                    <p><strong>Email:</strong> <span id="detailEmail">-</span></p>
                                    <p><strong>Property Value:</strong> <span id="detailPropertyValue">-</span></p>
                                    <p><strong>LTV:</strong> <span id="detailLTV">-</span></p>
                                    <p><strong>Target Rate:</strong> <span id="detailTargetRate">-</span></p>
                                    <p><strong>Lender:</strong> <span id="detailLender">-</span></p>
                                    <p><strong>Funded Date:</strong> <span id="detailFundedDate">-</span></p>
                                </div>
                                
                                <div class="form-group" style="margin-top: 1.5rem;">
                                    <label for="customerNotes">Notes</label>
                                    <div id="customerNotes" style="padding: 1rem; background-color: rgba(0, 0, 0, 0.03); border-radius: 0.5rem; min-height: 100px;">-</div>
                                </div>
                                
                                <div class="form-row" style="margin-top: 1.5rem;">
                                    <button id="editCustomerBtn" class="btn btn-primary">
                                        <i class="fas fa-edit"></i> Edit Customer
                                    </button>
                                    <button id="logContactBtn" class="btn btn-secondary">
                                        <i class="fas fa-phone"></i> Log Contact
                                    </button>
                                </div>
                            </div>
                            
                            <div id="contactLog" class="tab-content">
                                <div class="form-group">
                                    <label for="newContactNote">Add Contact Note</label>
                                    <textarea id="newContactNote" rows="3" placeholder="Enter details about your contact with this customer..."></textarea>
                                </div>
                                
                                <button id="addContactBtn" class="btn btn-primary" style="margin-bottom: 1.5rem;">
                                    <i class="fas fa-plus"></i> Add Contact Note
                                </button>
                                
                                <div id="contactLogList" class="contact-log">
                                    <div class="empty-state">
                                        <i class="fas fa-phone"></i>
                                        <h3>No contact log entries</h3>
                                        <p>Log your first contact with this customer</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="welcomeScreen" class="card">
                        <div class="card-body">
                            <div class="empty-state">
                                <i class="fas fa-home"></i>
                                <h3>Welcome to Mortgage Customer Manager</h3>
                                <p>Select a customer from the list or add a new customer to get started</p>
                                <button id="welcomeAddBtn2" class="btn btn-primary">
                                    <i class="fas fa-user-plus"></i> Add Your First Customer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="importExport" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Import/Export Data</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="importFile">Import Data</label>
                    <input type="file" id="importFile" accept=".json,.xlsx,.xls">
                    <div style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--gray);">
                        Supported formats: JSON, Excel (.xlsx, .xls)
                    </div>
                </div>
                <p style="margin-bottom: 1rem;">Import your customer data from JSON or Excel files, or export current data to back it up.</p>
            </div>
            <div class="modal-footer">
                <button id="exportDataBtn" class="btn btn-secondary">Export Data</button>
                <button id="importDataBtn" class="btn btn-primary">Import Data</button>
            </div>
        </div>
    </div>

    <div id="toastContainer"></div>

    <script>
        // Customer database
        let customers = [];
        let contactLogs = [];
        let filteredCustomers = [];
        let currentTab = 'allCustomers';
        let selectedCustomerId = null;
        let currentTheme = 'default';
        
        // DOM Elements
        const customerList = document.getElementById('customerList');
        const customerForm = document.getElementById('customerForm');
        const customerDetail = document.getElementById('customerDetail');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const addEditCustomerForm = document.getElementById('addEditCustomerForm');
        const searchInput = document.getElementById('searchInput');
        const addCustomerBtn = document.getElementById('addCustomerBtn');
        const welcomeAddBtn = document.getElementById('welcomeAddBtn');
        const welcomeAddBtn2 = document.getElementById('welcomeAddBtn2');
        const cancelFormBtn = document.getElementById('cancelFormBtn');
        const editCustomerBtn = document.getElementById('editCustomerBtn');
        const logContactBtn = document.getElementById('logContactBtn');
        const addContactBtn = document.getElementById('addContactBtn');
        const newContactNote = document.getElementById('newContactNote');
        const contactLogList = document.getElementById('contactLogList');
        const filterLoanPurpose = document.getElementById('filterLoanPurpose');
        const filterState = document.getElementById('filterState');
        const importExportBtn = document.getElementById('importExportBtn');
        const importExportModal = document.getElementById('importExport');
        const closeModalBtn = document.querySelector('.close-modal');
        const exportDataBtn = document.getElementById('exportDataBtn');
        const importDataBtn = document.getElementById('importDataBtn');
        const importFile = document.getElementById('importFile');
        const themeToggleBtn = document.getElementById('themeToggleBtn');
        const currentThemeText = document.getElementById('currentTheme');
        
        // Stats elements
        const totalCustomersElement = document.getElementById('totalCustomers');
        const totalLoansElement = document.getElementById('totalLoans');
        const duplicateContactsElement = document.getElementById('duplicateContacts');
        const avgLoanAmountElement = document.getElementById('avgLoanAmount');
        
        // Stars for space theme
        function createStars() {
            const starsContainer = document.getElementById('starsContainer');
            starsContainer.innerHTML = '';
            
            const numStars = 200;
            
            for (let i = 0; i < numStars; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // Random position
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                
                // Random size (0.5px - 2px)
                const size = Math.random() * 1.5 + 0.5;
                
                // Random twinkling duration and delay
                const duration = Math.random() * 5 + 3; // 3-8s
                const delay = Math.random() * 5; // 0-5s
                
                star.style.left = `${x}%`;
                star.style.top = `${y}%`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.setProperty('--twinkle-duration', `${duration}s`);
                star.style.setProperty('--twinkle-delay', `${delay}s`);
                
                starsContainer.appendChild(star);
            }
        }
        
        // Create stars on load
        createStars();
        
        // Create floating leaves for hippy hiker theme
        function createLeaves() {
            const natureContainer = document.getElementById('natureContainer');
            natureContainer.innerHTML = '';
            
            const numLeaves = 20;
            
            for (let i = 0; i < numLeaves; i++) {
                const leaf = document.createElement('div');
                leaf.classList.add('leaf');
                
                // Randomly choose leaf type
                if (Math.random() > 0.5) {
                    leaf.classList.add('leaf1');
                } else {
                    leaf.classList.add('leaf2');
                }
                
                // Random position
                const x = Math.random() * 100;
                
                // Random animation duration and delay
                const duration = Math.random() * 15 + 15; // 15-30s
                const delay = Math.random() * 15; // 0-15s
                
                leaf.style.left = `${x}%`;
                leaf.style.animationDuration = `${duration}s`;
                leaf.style.animationDelay = `${delay}s`;
                
                natureContainer.appendChild(leaf);
            }
        }
        
        createLeaves();
        
        // Star twinkling animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes twinkle {
                0%, 100% { opacity: 0.1; }
                50% { opacity: 1; }
            }
        `;
        document.head.appendChild(style);
        
        // Theme toggle
        themeToggleBtn.addEventListener('click', () => {
            // First remove all theme classes
            document.body.classList.remove('theme-space', 'theme-hippy-hiker', 'theme-hawaii');
            
            // Cycle through themes
            if (currentTheme === 'default') {
                currentTheme = 'space';
                document.body.classList.add('theme-space');
                currentThemeText.textContent = 'Space';
                themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i> Space';
            } else if (currentTheme === 'space') {
                currentTheme = 'hippy-hiker';
                document.body.classList.add('theme-hippy-hiker');
                currentThemeText.textContent = 'Hippy Hiker';
                themeToggleBtn.innerHTML = '<i class="fas fa-tree"></i> Hippy Hiker';
            } else if (currentTheme === 'hippy-hiker') {
                currentTheme = 'hawaii';
                document.body.classList.add('theme-hawaii');
                currentThemeText.textContent = 'Hawaii Beach';
                themeToggleBtn.innerHTML = '<i class="fas fa-umbrella-beach"></i> Hawaii Beach';
            } else {
                currentTheme = 'default';
                currentThemeText.textContent = 'Default';
                themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i> Default';
            }
            
            // Save theme preference
            localStorage.setItem('mortgageTheme', currentTheme);
        });
        
        // Initialize the application
        function init() {
            loadFromLocalStorage();
            setupEventListeners();
            renderCustomerList();
            updateStats();
            populateStateFilter();
            
            // Load theme from local storage
            const savedTheme = localStorage.getItem('mortgageTheme') || 'default';
            if (savedTheme === 'space') {
                currentTheme = 'space';
                document.body.classList.add('theme-space');
                currentThemeText.textContent = 'Space';
                themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i> Space';
            } else if (savedTheme === 'hippy-hiker') {
                currentTheme = 'hippy-hiker';
                document.body.classList.add('theme-hippy-hiker');
                currentThemeText.textContent = 'Hippy Hiker';
                themeToggleBtn.innerHTML = '<i class="fas fa-tree"></i> Hippy Hiker';
            } else if (savedTheme === 'hawaii') {
                currentTheme = 'hawaii';
                document.body.classList.add('theme-hawaii');
                currentThemeText.textContent = 'Hawaii Beach';
                themeToggleBtn.innerHTML = '<i class="fas fa-umbrella-beach"></i> Hawaii Beach';
            }
        }
        
        // Load data from localStorage
        function loadFromLocalStorage() {
            const savedCustomers = localStorage.getItem('mortgageCustomers');
            const savedContactLogs = localStorage.getItem('mortgageContactLogs');
            
            if (savedCustomers) {
                customers = JSON.parse(savedCustomers);
            }
            
            if (savedContactLogs) {
                contactLogs = JSON.parse(savedContactLogs);
            }
        }
        
        // Save data to localStorage
        function saveToLocalStorage() {
            localStorage.setItem('mortgageCustomers', JSON.stringify(customers));
            localStorage.setItem('mortgageContactLogs', JSON.stringify(contactLogs));
        }
        
        // Calculate LTV automatically when property value or loan amount changes
        function calculateLTV() {
            const propertyValue = parseFloat(document.getElementById('propertyValue').value) || 0;
            const loanAmount = parseFloat(document.getElementById('loanAmount').value) || 0;
            
            if (propertyValue > 0) {
                const ltv = ((loanAmount / propertyValue) * 100).toFixed(2);
                document.getElementById('ltv').value = ltv + '%';
            } else {
                document.getElementById('ltv').value = '';
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Form submissions
            addEditCustomerForm.addEventListener('submit', handleCustomerFormSubmit);
            
            // Auto-calculate LTV
            document.getElementById('propertyValue').addEventListener('input', calculateLTV);
            document.getElementById('loanAmount').addEventListener('input', calculateLTV);
            
            // Buttons
            addCustomerBtn.addEventListener('click', showAddCustomerForm);
            welcomeAddBtn.addEventListener('click', showAddCustomerForm);
            welcomeAddBtn2.addEventListener('click', showAddCustomerForm);
            cancelFormBtn.addEventListener('click', hideCustomerForm);
            editCustomerBtn.addEventListener('click', handleEditCustomer);
            logContactBtn.addEventListener('click', () => {
                activateTab('contactLog');
                newContactNote.focus();
            });
            addContactBtn.addEventListener('click', handleAddContactNote);
            
            // Search and filters
            searchInput.addEventListener('input', handleSearch);
            filterLoanPurpose.addEventListener('change', applyFilters);
            filterState.addEventListener('change', applyFilters);
            
            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const tabName = e.target.dataset.tab;
                    activateTab(tabName);
                });
            });
            
            // Import/Export
            importExportBtn.addEventListener('click', () => {
                importExportModal.classList.add('active');
            });
            
            closeModalBtn.addEventListener('click', () => {
                importExportModal.classList.remove('active');
            });
            
            exportDataBtn.addEventListener('click', exportData);
            importDataBtn.addEventListener('click', importData);
            
            // Close modal on outside click
            importExportModal.addEventListener('click', (e) => {
                if (e.target === importExportModal) {
                    importExportModal.classList.remove('active');
                }
            });
        }
        
        // Activate a tab
        function activateTab(tabName) {
            // Handle main tabs (All Customers vs Duplicate Contacts)
            if (tabName === 'allCustomers' || tabName === 'duplicateContacts') {
                currentTab = tabName;
                document.querySelectorAll('.tabs .tab').forEach(tab => {
                    if (tab.dataset.tab === tabName) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
                renderCustomerList();
                return;
            }
            
            // Handle customer detail tabs
            const tabElement = document.querySelector(`.tab[data-tab="${tabName}"]`);
            const tabContentElement = document.getElementById(tabName);
            
            if (tabElement && tabContentElement) {
                // Deactivate all tabs in this group
                const tabGroup = tabElement.closest('.tabs');
                tabGroup.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Find all related tab contents
                const tabContents = tabGroup.nextElementSibling;
                let currentContent = tabContents;
                
                while (currentContent && !currentContent.classList.contains('tabs')) {
                    if (currentContent.classList.contains('tab-content')) {
                        currentContent.classList.remove('active');
                    }
                    currentContent = currentContent.nextElementSibling;
                }
                
                // Activate selected tab
                tabElement.classList.add('active');
                tabContentElement.classList.add('active');
            }
        }
        
        // Show add customer form
        function showAddCustomerForm() {
            // Reset form
            addEditCustomerForm.reset();
            document.getElementById('customerId').value = '';
            document.querySelector('.card-title').textContent = 'Add New Customer';
            
            // Show form, hide other panels
            customerForm.style.display = 'block';
            customerDetail.style.display = 'none';
            welcomeScreen.style.display = 'none';
            
            // Focus on first input
            document.getElementById('primaryFirstName').focus();
        }
        
        // Hide customer form
        function hideCustomerForm() {
            customerForm.style.display = 'none';
            
            if (selectedCustomerId) {
                customerDetail.style.display = 'block';
            } else {
                welcomeScreen.style.display = 'block';
            }
        }
        
        // Handle customer form submit
        function handleCustomerFormSubmit(e) {
            e.preventDefault();
            
            const customerId = document.getElementById('customerId').value;
            const isEdit = customerId !== '';
            
            const propertyValue = parseFloat(document.getElementById('propertyValue').value) || 0;
            const loanAmount = parseFloat(document.getElementById('loanAmount').value) || 0;
            
            const customer = {
                id: isEdit ? customerId : Date.now().toString(),
                primaryFirstName: document.getElementById('primaryFirstName').value,
                primaryLastName: document.getElementById('primaryLastName').value,
                primaryFullName: `${document.getElementById('primaryFirstName').value} ${document.getElementById('primaryLastName').value}`,
                coFirstName: document.getElementById('coFirstName').value,
                coLastName: document.getElementById('coLastName').value,
                coFullName: document.getElementById('coFirstName').value && document.getElementById('coLastName').value ? 
                           `${document.getElementById('coFirstName').value} ${document.getElementById('coLastName').value}` : '',
                primaryPhone: document.getElementById('primaryPhone').value,
                primaryCellPhone: document.getElementById('primaryCellPhone').value,
                whenToCall: document.getElementById('whenToCall').value,
                email: document.getElementById('email').value,
                loanPurpose: document.getElementById('loanPurpose').value,
                propertyValue: propertyValue,
                loanAmount: loanAmount,
                rate: document.getElementById('rate').value,
                ltv: document.getElementById('ltv').value,
                refinanceTargetRate: document.getElementById('refinanceTargetRate').value,
                propertyAddress: document.getElementById('propertyAddress').value,
                propertyState: document.getElementById('propertyState').value,
                lender: document.getElementById('lender').value,
                fundedDate: document.getElementById('fundedDate').value,
                notes: document.getElementById('notes').value,
                createdAt: isEdit ? customers.find(c => c.id === customerId).createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (isEdit) {
                // Update existing customer
                const index = customers.findIndex(c => c.id === customerId);
                if (index !== -1) {
                    customers[index] = customer;
                }
                showToast('Customer updated successfully', 'success');
            } else {
                // Add new customer
                customers.push(customer);
                showToast('Customer added successfully', 'success');
            }
            
            // Save data
            saveToLocalStorage();
            
            // Update UI
            renderCustomerList();
            updateStats();
            
            // Show customer details
            showCustomerDetails(customer.id);
        }
        
        // Render customer list
        function renderCustomerList() {
            // Get duplicate phone numbers
            const phoneNumberCounts = {};
            customers.forEach(customer => {
                const phone = customer.primaryPhone;
                if (phone) {
                    phoneNumberCounts[phone] = (phoneNumberCounts[phone] || 0) + 1;
                }
            });
            
            // Filter and sort customers
            let customersToShow = [...customers];
            
            // Filter by search text
            const searchText = searchInput.value.toLowerCase();
            if (searchText) {
                customersToShow = customersToShow.filter(customer => 
                    customer.primaryFullName.toLowerCase().includes(searchText) || 
                    (customer.coFullName && customer.coFullName.toLowerCase().includes(searchText)) ||
                    (customer.primaryPhone && customer.primaryPhone.toLowerCase().includes(searchText)) ||
                    (customer.propertyAddress && customer.propertyAddress.toLowerCase().includes(searchText)) ||
                    (customer.loanPurpose && customer.loanPurpose.toLowerCase().includes(searchText))
                );
            }
            
            // Filter by loan purpose
            const purposeFilter = filterLoanPurpose.value;
            if (purposeFilter) {
                customersToShow = customersToShow.filter(customer => customer.loanPurpose === purposeFilter);
            }
            
            // Filter by state
            const stateFilter = filterState.value;
            if (stateFilter) {
                customersToShow = customersToShow.filter(customer => customer.propertyState === stateFilter);
            }
            
            // Filter by duplicate contacts tab
            if (currentTab === 'duplicateContacts') {
                customersToShow = customersToShow.filter(customer => 
                    customer.primaryPhone && phoneNumberCounts[customer.primaryPhone] > 1
                );
            }
            
            // Sort by date (newest first)
            customersToShow.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
            
            // Save filtered list for reference
            filteredCustomers = customersToShow;
            
            // Render the list
            if (customersToShow.length === 0) {
                customerList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>No customers found</h3>
                        <p>Try adjusting your search or filters</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            customersToShow.forEach(customer => {
                const isDuplicate = customer.primaryPhone && phoneNumberCounts[customer.primaryPhone] > 1;
                
                html += `
                    <div class="customer-card ${isDuplicate ? 'duplicate-contact' : ''}" data-id="${customer.id}">
                        <h3>${customer.primaryFullName} ${isDuplicate ? '<span class="badge badge-warning">Duplicate</span>' : ''}</h3>
                        <div class="customer-card-details">
                            <p><strong>Phone:</strong> ${customer.primaryPhone}</p>
                            <p><strong>Loan Purpose:</strong> ${customer.loanPurpose}</p>
                            <p><strong>Loan Amount:</strong> $${customer.loanAmount.toLocaleString()}</p>
                            <p><strong>Property:</strong> ${customer.propertyState}</p>
                        </div>
                        <div class="customer-actions">
                            <button class="action-btn call-btn" title="Call Customer" onclick="callCustomer('${customer.id}')">
                                <i class="fas fa-phone"></i>
                            </button>
                            <button class="action-btn edit-btn" title="Edit Customer" onclick="editCustomer('${customer.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" title="Delete Customer" onclick="deleteCustomer('${customer.id}')">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            customerList.innerHTML = html;
            
            // Add click event to customer cards
            document.querySelectorAll('.customer-card').forEach(card => {
                card.addEventListener('click', function(e) {
                    // Ignore clicks on action buttons
                    if (e.target.closest('.customer-actions')) {
                        return;
                    }
                    
                    const customerId = this.dataset.id;
                    showCustomerDetails(customerId);
                });
            });
        }
        
        // Show customer details
        function showCustomerDetails(customerId) {
            const customer = customers.find(c => c.id === customerId);
            
            if (!customer) {
                return;
            }
            
            selectedCustomerId = customerId;
            
            // Update customer details view
            document.getElementById('customerName').textContent = customer.primaryFullName;
            document.getElementById('detailLoanAmount').textContent = `$${customer.loanAmount.toLocaleString()}`;
            document.getElementById('detailLoanPurpose').textContent = customer.loanPurpose;
            document.getElementById('detailRate').textContent = customer.rate ? `${customer.rate}%` : '-';
            document.getElementById('detailProperty').textContent = `${customer.propertyAddress}, ${customer.propertyState}`;
            document.getElementById('detailPhone').textContent = customer.primaryPhone;
            document.getElementById('detailWhenToCall').textContent = customer.whenToCall || 'Anytime';
            
            document.getElementById('detailPrimaryBorrower').textContent = customer.primaryFullName;
            document.getElementById('detailCoBorrower').textContent = customer.coFullName || '-';
            document.getElementById('detailCellPhone').textContent = customer.primaryCellPhone || '-';
            document.getElementById('detailEmail').textContent = customer.email || '-';
            document.getElementById('detailPropertyValue').textContent = customer.propertyValue ? `$${customer.propertyValue.toLocaleString()}` : '-';
            document.getElementById('detailLTV').textContent = customer.ltv || '-';
            document.getElementById('detailTargetRate').textContent = customer.refinanceTargetRate ? `${customer.refinanceTargetRate}` : '-';
            document.getElementById('detailLender').textContent = customer.lender || '-';
            document.getElementById('detailFundedDate').textContent = customer.fundedDate ? new Date(customer.fundedDate).toLocaleDateString() : '-';
            
            document.getElementById('customerNotes').textContent = customer.notes || 'No notes available';
            
            // Render contact log
            renderContactLog(customerId);
            
            // Show details view, hide other panels
            customerDetail.style.display = 'block';
            customerForm.style.display = 'none';
            welcomeScreen.style.display = 'none';
            
            // Activate info tab by default
            activateTab('customerInfo');
        }
        
        // Render contact log
        function renderContactLog(customerId) {
            const customerLogs = contactLogs.filter(log => log.customerId === customerId);
            
            if (customerLogs.length === 0) {
                contactLogList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-phone"></i>
                        <h3>No contact log entries</h3>
                        <p>Log your first contact with this customer</p>
                    </div>
                `;
                return;
            }
            
            // Sort by date (newest first)
            customerLogs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            let html = '';
            
            customerLogs.forEach(log => {
                const date = new Date(log.timestamp).toLocaleString();
                
                html += `
                    <div class="contact-entry">
                        <div class="contact-entry-header">
                            <strong>Contact on ${date}</strong>
                            <button class="action-btn delete-btn" title="Delete Entry" onclick="deleteContactLog('${log.id}')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <p>${log.note}</p>
                    </div>
                `;
            });
            
            contactLogList.innerHTML = html;
        }
        
        // Handle adding a contact note
        function handleAddContactNote() {
            const note = newContactNote.value.trim();
            
            if (!note) {
                showToast('Please enter a contact note', 'error');
                return;
            }
            
            const contactLog = {
                id: Date.now().toString(),
                customerId: selectedCustomerId,
                note: note,
                timestamp: new Date().toISOString()
            };
            
            contactLogs.push(contactLog);
            saveToLocalStorage();
            
            // Update customer's updatedAt timestamp
            const customerIndex = customers.findIndex(c => c.id === selectedCustomerId);
            if (customerIndex !== -1) {
                customers[customerIndex].updatedAt = new Date().toISOString();
                saveToLocalStorage();
            }
            
            // Reset form and render logs
            newContactNote.value = '';
            renderContactLog(selectedCustomerId);
            showToast('Contact note added', 'success');
        }
        
        // Handle search
        function handleSearch() {
            renderCustomerList();
        }
        
        // Apply filters
        function applyFilters() {
            renderCustomerList();
        }
        
        // Handle edit customer
        function handleEditCustomer() {
            editCustomer(selectedCustomerId);
        }
        
        // Edit customer
        function editCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            
            if (!customer) {
                return;
            }
            
            // Populate form
            document.getElementById('customerId').value = customer.id;
            document.getElementById('primaryFirstName').value = customer.primaryFirstName;
            document.getElementById('primaryLastName').value = customer.primaryLastName;
            document.getElementById('coFirstName').value = customer.coFirstName || '';
            document.getElementById('coLastName').value = customer.coLastName || '';
            document.getElementById('primaryPhone').value = customer.primaryPhone;
            document.getElementById('primaryCellPhone').value = customer.primaryCellPhone || '';
            document.getElementById('whenToCall').value = customer.whenToCall || '';
            document.getElementById('email').value = customer.email || '';
            document.getElementById('loanPurpose').value = customer.loanPurpose;
            document.getElementById('propertyValue').value = customer.propertyValue || '';
            document.getElementById('loanAmount').value = customer.loanAmount;
            document.getElementById('rate').value = customer.rate || '';
            document.getElementById('ltv').value = customer.ltv || '';
            document.getElementById('refinanceTargetRate').value = customer.refinanceTargetRate || '';
            document.getElementById('propertyAddress').value = customer.propertyAddress;
            document.getElementById('propertyState').value = customer.propertyState;
            document.getElementById('lender').value = customer.lender || '';
            document.getElementById('fundedDate').value = customer.fundedDate || '';
            document.getElementById('notes').value = customer.notes || '';
            
            // Update form title
            document.querySelector('.card-title').textContent = 'Edit Customer';
            
            // Show form
            customerForm.style.display = 'block';
            customerDetail.style.display = 'none';
            welcomeScreen.style.display = 'none';
        }
        
        // Call customer
        function callCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            
            if (!customer || !customer.primaryPhone) {
                return;
            }
            
            // Create a tel: link to initiate call
            window.open(`tel:${customer.primaryPhone}`);
            
            // Select the customer and show contact log
            showCustomerDetails(customerId);
            activateTab('contactLog');
            
            // Focus on the contact note field with a pre-filled template
            newContactNote.value = `Called ${customer.primaryFullName} on ${new Date().toLocaleString()}.\n\nDiscussion: `;
            newContactNote.focus();
        }
        
        // Delete customer
        function deleteCustomer(customerId) {
            if (!confirm('Are you sure you want to delete this customer? This action cannot be undone.')) {
                return;
            }
            
            // Remove customer
            customers = customers.filter(c => c.id !== customerId);
            
            // Remove associated contact logs
            contactLogs = contactLogs.filter(log => log.customerId !== customerId);
            
            // Save data
            saveToLocalStorage();
            
            // Update UI
            renderCustomerList();
            updateStats();
            
            // If deleted customer was selected
            if (selectedCustomerId === customerId) {
                selectedCustomerId = null;
                customerDetail.style.display = 'none';
                welcomeScreen.style.display = 'block';
            }
            
            showToast('Customer deleted', 'success');
        }
        
        // Delete contact log
        function deleteContactLog(logId) {
            if (!confirm('Are you sure you want to delete this contact log entry?')) {
                return;
            }
            
            // Remove log
            contactLogs = contactLogs.filter(log => log.id !== logId);
            
            // Save data
            saveToLocalStorage();
            
            // Update UI
            renderContactLog(selectedCustomerId);
            
            showToast('Contact log entry deleted', 'success');
        }
        
        // Update statistics
        function updateStats() {
            // Total customers
            totalCustomersElement.textContent = customers.length;
            
            // Total loan volume
            const totalLoanAmount = customers.reduce((sum, customer) => sum + (customer.loanAmount || 0), 0);
            totalLoansElement.textContent = `$${totalLoanAmount.toLocaleString()}`;
            
            // Average loan amount
            const avgLoanAmount = customers.length > 0 ? totalLoanAmount / customers.length : 0;
            avgLoanAmountElement.textContent = `$${Math.round(avgLoanAmount).toLocaleString()}`;
            
            // Count duplicate contacts
            const phoneNumbers = {};
            let duplicateCount = 0;
            
            customers.forEach(customer => {
                if (customer.primaryPhone) {
                    phoneNumbers[customer.primaryPhone] = (phoneNumbers[customer.primaryPhone] || 0) + 1;
                    if (phoneNumbers[customer.primaryPhone] === 2) {
                        duplicateCount += 1;
                    }
                }
            });
            
            duplicateContactsElement.textContent = duplicateCount;
        }
        
        // Populate state filter
        function populateStateFilter() {
            const states = new Set();
            customers.forEach(customer => {
                if (customer.propertyState) {
                    states.add(customer.propertyState);
                }
            });
            
            const stateOptions = Array.from(states).sort();
            
            let html = '<option value="">All States</option>';
            stateOptions.forEach(state => {
                html += `<option value="${state}">${state}</option>`;
            });
            
            filterState.innerHTML = html;
        }
        
        // Export data
        function exportData() {
            const data = {
                customers: customers,
                contactLogs: contactLogs
            };
            
            // Create export options
            const exportOptions = document.createElement('div');
            exportOptions.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <h3 style="margin-bottom: 0.5rem;">Export Format</h3>
                    <div style="display: flex; gap: 1rem;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="exportFormat" value="json" checked style="margin-right: 0.5rem;"> JSON
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="exportFormat" value="excel" style="margin-right: 0.5rem;"> Excel
                        </label>
                    </div>
                </div>
            `;
            
            // Replace modal content
            const modalBody = document.querySelector('.modal-body');
            const originalModalContent = modalBody.innerHTML;
            modalBody.innerHTML = '';
            modalBody.appendChild(exportOptions);
            
            // Update modal footer
            const modalFooter = document.querySelector('.modal-footer');
            const originalFooterContent = modalFooter.innerHTML;
            modalFooter.innerHTML = `
                <button id="cancelExportBtn" class="btn btn-secondary">Cancel</button>
                <button id="confirmExportBtn" class="btn btn-primary">Export</button>
            `;
            
            // Add event listeners
            document.getElementById('cancelExportBtn').addEventListener('click', () => {
                modalBody.innerHTML = originalModalContent;
                modalFooter.innerHTML = originalFooterContent;
            });
            
            document.getElementById('confirmExportBtn').addEventListener('click', () => {
                const format = document.querySelector('input[name="exportFormat"]:checked').value;
                
                if (format === 'json') {
                    exportJsonData(data);
                } else if (format === 'excel') {
                    exportExcelData(data);
                }
                
                // Restore modal
                modalBody.innerHTML = originalModalContent;
                modalFooter.innerHTML = originalFooterContent;
                importExportModal.classList.remove('active');
            });
        }
        
        // Export as JSON
        function exportJsonData(data) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `mortgage-customers-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            
            showToast('Data exported successfully as JSON', 'success');
        }
        
        // Export as Excel
        function exportExcelData(data) {
            try {
                // Create a workbook with two sheets
                const wb = XLSX.utils.book_new();
                
                // Prepare customer data for export
                const customersForExport = data.customers.map(customer => {
                    return {
                        id: customer.id,
                        primaryFirstName: customer.primaryFirstName,
                        primaryLastName: customer.primaryLastName,
                        coFirstName: customer.coFirstName,
                        coLastName: customer.coLastName,
                        primaryPhone: customer.primaryPhone,
                        primaryCellPhone: customer.primaryCellPhone,
                        whenToCall: customer.whenToCall,
                        email: customer.email,
                        loanPurpose: customer.loanPurpose,
                        propertyValue: customer.propertyValue,
                        loanAmount: customer.loanAmount,
                        rate: customer.rate,
                        ltv: customer.ltv,
                        refinanceTargetRate: customer.refinanceTargetRate,
                        propertyAddress: customer.propertyAddress,
                        propertyState: customer.propertyState,
                        lender: customer.lender,
                        fundedDate: customer.fundedDate,
                        notes: customer.notes,
                        createdAt: customer.createdAt,
                        updatedAt: customer.updatedAt
                    };
                });
                
                // Create customers sheet
                const customersWs = XLSX.utils.json_to_sheet(customersForExport);
                XLSX.utils.book_append_sheet(wb, customersWs, "Customers");
                
                // Create contact logs sheet if there are any
                if (data.contactLogs.length > 0) {
                    const contactLogsWs = XLSX.utils.json_to_sheet(data.contactLogs);
                    XLSX.utils.book_append_sheet(wb, contactLogsWs, "ContactLogs");
                }
                
                // Generate Excel file and trigger download
                XLSX.writeFile(wb, `mortgage-customers-${new Date().toISOString().split('T')[0]}.xlsx`);
                
                showToast('Data exported successfully as Excel', 'success');
            } catch (error) {
                showToast('Error exporting to Excel: ' + error.message, 'error');
                console.error(error);
            }
        }
        
        // Import data
        function importData() {
            const file = importFile.files[0];
            
            if (!file) {
                showToast('Please select a file to import', 'error');
                return;
            }
            
            const fileExtension = file.name.split('.').pop().toLowerCase();
            
            if (fileExtension === 'json') {
                importJsonData(file);
            } else if (fileExtension === 'xlsx' || fileExtension === 'xls') {
                importExcelData(file);
            } else {
                showToast('Unsupported file format. Please use JSON or Excel files.', 'error');
            }
        }
        
        // Import JSON data
        function importJsonData(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.customers && Array.isArray(data.customers) && 
                        data.contactLogs && Array.isArray(data.contactLogs)) {
                        
                        // Confirm before overwriting
                        if (customers.length > 0 && !confirm('This will overwrite your existing data. Continue?')) {
                            return;
                        }
                        
                        customers = data.customers;
                        contactLogs = data.contactLogs;
                        
                        saveToLocalStorage();
                        renderCustomerList();
                        updateStats();
                        populateStateFilter();
                        
                        showToast('Data imported successfully from JSON', 'success');
                        importExportModal.classList.remove('active');
                        
                        // Reset selection
                        selectedCustomerId = null;
                        customerDetail.style.display = 'none';
                        welcomeScreen.style.display = 'block';
                    } else {
                        showToast('Invalid JSON data format', 'error');
                    }
                } catch (error) {
                    showToast('Error parsing JSON file: ' + error.message, 'error');
                }
            };
            
            reader.readAsText(file);
        }
        
        // Import Excel data
        function importExcelData(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Assume first sheet contains customer data
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // Convert to JSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    if (jsonData.length === 0) {
                        showToast('No data found in Excel file', 'error');
                        return;
                    }
                    
                    // Check if there's a second sheet for contact logs
                    let contactLogsData = [];
                    if (workbook.SheetNames.length > 1) {
                        const secondSheetName = workbook.SheetNames[1];
                        const contactLogSheet = workbook.Sheets[secondSheetName];
                        contactLogsData = XLSX.utils.sheet_to_json(contactLogSheet);
                    }
                    
                    // Confirm before overwriting
                    if (customers.length > 0 && !confirm('This will overwrite your existing data. Continue?')) {
                        return;
                    }
                    
                    // Process customer data
                    const newCustomers = jsonData.map(row => {
                        const customer = {
                            id: row.id || Date.now().toString() + Math.random().toString(36).substring(2, 9),
                            primaryFirstName: row.primaryFirstName || row.firstName || '',
                            primaryLastName: row.primaryLastName || row.lastName || '',
                            primaryFullName: `${row.primaryFirstName || row.firstName || ''} ${row.primaryLastName || row.lastName || ''}`.trim(),
                            coFirstName: row.coFirstName || '',
                            coLastName: row.coLastName || '',
                            coFullName: row.coFirstName && row.coLastName ? `${row.coFirstName} ${row.coLastName}` : '',
                            primaryPhone: row.primaryPhone || row.phone || '',
                            primaryCellPhone: row.primaryCellPhone || row.cellPhone || '',
                            whenToCall: row.whenToCall || '',
                            email: row.email || '',
                            loanPurpose: row.loanPurpose || '',
                            propertyValue: parseFloat(row.propertyValue) || 0,
                            loanAmount: parseFloat(row.loanAmount) || 0,
                            rate: row.rate || '',
                            ltv: row.ltv || '',
                            refinanceTargetRate: row.refinanceTargetRate || '',
                            propertyAddress: row.propertyAddress || row.address || '',
                            propertyState: row.propertyState || row.state || '',
                            lender: row.lender || '',
                            fundedDate: row.fundedDate || '',
                            notes: row.notes || '',
                            createdAt: row.createdAt || new Date().toISOString(),
                            updatedAt: row.updatedAt || new Date().toISOString()
                        };
                        
                        return customer;
                    });
                    
                    // Process contact logs if available
                    const newContactLogs = contactLogsData.map(row => {
                        return {
                            id: row.id || Date.now().toString() + Math.random().toString(36).substring(2, 9),
                            customerId: row.customerId || '',
                            note: row.note || '',
                            timestamp: row.timestamp || new Date().toISOString()
                        };
                    });
                    
                    // Update data
                    customers = newCustomers;
                    if (newContactLogs.length > 0) {
                        contactLogs = newContactLogs;
                    }
                    
                    saveToLocalStorage();
                    renderCustomerList();
                    updateStats();
                    populateStateFilter();
                    
                    showToast(`Imported ${customers.length} customers from Excel successfully`, 'success');
                    importExportModal.classList.remove('active');
                    
                    // Reset selection
                    selectedCustomerId = null;
                    customerDetail.style.display = 'none';
                    welcomeScreen.style.display = 'block';
                    
                } catch (error) {
                    showToast('Error processing Excel file: ' + error.message, 'error');
                    console.error(error);
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // Show toast message
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            let icon = 'info-circle';
            let title = 'Information';
            
            if (type === 'success') {
                icon = 'check-circle';
                title = 'Success';
            } else if (type === 'error') {
                icon = 'exclamation-circle';
                title = 'Error';
            } else if (type === 'warning') {
                icon = 'exclamation-triangle';
                title = 'Warning';
            }
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas fa-${icon}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Show the toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Hide and remove the toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }
        
        // Make these functions globally available for HTML onclick
        window.callCustomer = callCustomer;
        window.editCustomer = editCustomer;
        window.deleteCustomer = deleteCustomer;
        window.deleteContactLog = deleteContactLog;
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>